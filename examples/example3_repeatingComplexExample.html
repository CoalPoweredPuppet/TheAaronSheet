<div class="missing-css" style="font-weight: bold;color: red;">
    <h2>You are missing the CSS: </h2>
    <a style="font-size: .5em; color: blue; text-decoration: underline;" href="https://github.com/shdwjk/TheAaronSheet/blob/master/examples/examples.css">https://github.com/shdwjk/TheAaronSheet/blob/master/examples/examples.css</a>
</div>


<h3>Inventory</h3>

<div class="inventory-row headers">	
    <div class="name" >Item</div>
    <div class="quantity" >Qty</div>
    <div class="weight" >Weight</div>
    <div class="totalweight" >Total Weight</div>
    <div class="cost" >Cost($)</div>
    <div class="runningtotal" >Running Total($)</div>
</div>
<fieldset class="repeating_inventory">
	<div class="inventory-row">	
		<input class="name" type="text" name="attr_item" placeholder="item name" title="name" />
		<input class="quantity" type="text" name="attr_quantity" value="0" title="quantity" />
		<input class="weight" type="text" name="attr_weight" value="0" title="weight" />
		<input class="totalweight" type="text" name="attr_totalweight" value="0" title="totalweight" />
		<input class="cost" type="text" name="attr_cost" value="0" title="cost" />
		<input class="runningtotal" type="text" name="attr_runningtotal" value="0" title="running total" />
	</div>
</fieldset>

<div class="footer">
	<div class="total">Total Weight<br><input class="sumtotalweight" type="text" name="attr_total_weight" value="0" title="total weight" /></div>
	<div class="total">Total Cost<br><input class="sumtotalcost" type="text" name="attr_total_cost" value="0" title="total cost" /></div>
	<div class="total">Summary:<br><textarea class="summary" type="textarea" name="attr_summary" title="summary"/></textarea>
</div>



<div>TheAaronSheet :: <a href="https://github.com/shdwjk/TheAaronSheet">https://github.com/shdwjk/TheAaronSheet</a></div>



<script type="text/worker">

/*=include ../../../TheAaronSheet.js */

on('change:repeating_inventory', function(){

// all of these operations could likely have been done in a single reduce operation, but
// doing them in multiple operations shows that this is something that can be done.

    TAS.repeating('inventory')
        .attrs('total_weight','total_cost','summary')  //< getting the attributes for the totals
        .fields('item','quantity','weight','totalweight','cost','runningtotal') //< specifying the fields we care about
        .tap(function(rows,attrs){
			attrs.summary=_.pluck(_.values(rows),'item').join(', ');  //< grabing all the names of items and setting summary
        })
		.each(function(r){
			r.D[3].totalweight=(r.I.quantity*r.F.weight);  //< for each row, set the total weight with 3 decimal places (use integer quantity and floating weight)
		})
		.map(function(r){
			return r.F.weight*r.I.quantity; //< calculate the weight for the row (could have used the totalweight)
		},function(m,r,a){
            a.D[3].total_weight=_.reduce(m,function(m,v){ //<sum the array of total weights and set it on the total weight attribute
				return m+v;
			},0);
		})
		.reduce(function(m,r){
			m+=(r.I.quantity*r.F.cost); //< Generate a running cost
			r.D[2].runningtotal=m; //< set it for the current row (the running part)
			return m;
		},0,function(m,r,a){
			a.D[2].total_cost=m;  //< take the final sum and set it on the total cost attribute
		})
        .execute();  //< begin executing the above operations

});


</script>
